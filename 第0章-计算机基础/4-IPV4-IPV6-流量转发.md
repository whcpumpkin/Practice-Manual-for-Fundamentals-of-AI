# **IPv4 和 IPv6**
1. **IPv4（Internet Protocol version 4）**  
   - IPv4 是互联网协议的第四版，也是目前使用最广泛的版本。它使用 32 位地址，总共可以提供约 43 亿个唯一 IP 地址（2³²）。  
   - 格式：点分十进制表示法，例如 `192.168.1.1`。  
   - 缺点：由于地址空间有限，随着互联网设备数量的激增，IPv4 地址逐渐耗尽。

2. **IPv6（Internet Protocol version 6）**  
   - IPv6 是互联网协议的第六版，设计用来解决 IPv4 地址枯竭的问题。它使用 128 位地址，提供了几乎无限的地址空间（2¹²⁸）。  
   - 格式：冒号分隔的十六进制表示法，例如 `2001:0db8:85a3::8a2e:0370:7334`。  
   - 优点：更大的地址空间、更好的安全性、自动配置能力等。

---

# **公网和局域网**
1. **公网（Public Network）**  
   - 公网是指全球范围内的互联网，所有设备通过唯一的公网 IP 地址进行通信。  
   - 公网 IP 地址是全球唯一的，由互联网服务提供商（ISP）分配。  

2. **局域网（Local Area Network, LAN）**  
   - 局域网是一个小型网络，通常局限于家庭、办公室或学校等局部区域。  
   - 局域网中的设备使用私有 IP 地址（如 `192.168.x.x` 或 `10.x.x.x`），这些地址在局域网内唯一，但不能直接用于公网通信。

比如你的宽带可能被分配了一个公网 IP 地址，然后你的手机、电脑、平板等设备就被分配了私有 IP 地址。这些私有 IP 地址只能在局域网内通信，不能直接用于公网通信。你的手机、电脑、平板等设备通过路由器连接到公网，通过公网 IP 地址访问互联网。
---

# **内网和 NAT 技术**
1. **内网（Private Network）**  
   - 内网是局域网的一种形式，通常指家庭或企业内部的网络。内网中的设备使用私有 IP 地址，无法直接与公网通信。  

2. **NAT（Network Address Translation，网络地址转换）**  
   - NAT 是一种将内网私有 IP 地址转换为公网 IP 地址的技术，使多个内网设备可以通过一个公网 IP 访问外部网络。  
   - 工作原理：路由器会记录内网设备的请求，并将请求转发到公网，同时将响应数据返回给对应的内网设备。  
   - 类型：静态 NAT、动态 NAT 和端口地址转换（PAT，即常见的家用路由器 NAT）。

---

# **流量转发**
- 流量转发是指数据包从源地址传输到目标地址的过程。  
- 在 NAT 环境下，路由器负责将内网设备的流量转发到公网，并将公网的响应数据转发回内网设备。  
- 流量转发的关键在于路由器维护的 NAT 表，该表记录了内网设备的私有 IP 地址、端口号与公网 IP 地址、端口号之间的映射关系。

---
## **完整例子：家庭内网 IP 如何从教学网上下载一个文件**
## **场景描述**
假设你家有一个 Wi-Fi 路由器，连接了一台电脑（内网 IP 为 `192.168.1.100`），并通过 ISP 分配了一个公网 IP 地址（如 `203.0.113.45`）。你想从教学网站（域名 `course.pku.edu.cn`，IP 地址为 `162.105.205.204`）下载一个文件。

## **步骤解析**
1. **发起请求**  
   - 你的电脑向教学网站发送 HTTP 请求（假设使用端口 80）。  
   - 请求的目标地址是 `162.105.205.204:80`，源地址是 `192.168.1.100:12345`（12345 是随机生成的源端口）。  

2. **NAT 转换**  
   - 数据包到达路由器后，路由器执行 NAT 转换：  
     - 将源地址从 `192.168.1.100:12345` 替换为公网 IP 地址 `203.0.113.45:50000`（50000 是路由器分配的临时端口）。  
     - 路由器在 NAT 表中记录映射关系：  
       ```
       内网 IP:Port -> 公网 IP:Port
       192.168.1.100:12345 -> 203.0.113.45:50000
       ```

3. **公网传输**  
   - 路由器将转换后的数据包发送到教学网站的服务器（`162.105.205.204:80`）。  
   - 教学网站收到请求后，认为请求来自 `203.0.113.45:50000`，并准备响应数据。

4. **响应返回**  
   - 教学网站将响应数据发送到 `203.0.113.45:50000`。  
   - 路由器收到响应后，查询 NAT 表，找到对应的内网设备：  
     ```
     公网 IP:Port -> 内网 IP:Port
     203.0.113.45:50000 -> 192.168.1.100:12345
     ```  
   - 路由器将目标地址从 `203.0.113.45:50000` 转换回 `192.168.1.100:12345`，并将数据包转发到你的电脑。

5. **完成下载**  
   - 你的电脑接收到响应数据，完成文件下载。

---

# **总结**
- **IPv4 和 IPv6** 提供了设备通信的基础地址方案。  
- **公网和局域网** 定义了网络的范围和用途。  
- **NAT 技术** 实现了内网设备通过单一公网 IP 访问外部网络的功能。  
- **流量转发** 是数据包在不同网络之间传递的核心机制。  

通过上述例子可以看出，家庭内网设备能够借助 NAT 技术和路由器的支持，顺利访问外部网络资源，同时保持内网的安全性和隔离性。